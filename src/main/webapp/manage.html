<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Manager</title>

    <!-- Bootstrap core CSS -->
    <link href="styles/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="styles/manage.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="script/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="container">
      <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills pull-right">
            <li role="presentation" class="active"><a href="">Home</a></li>
            <li role="presentation"><a href="">Sign out</a></li>
          </ul>
        </nav>
        <h3 class="text-muted">Tongji Search Manage</h3>
      </div>

      <div class="manage">
        <div>
          <div>
            <h3 class="spider-title">网页抓取源</h3>
            <button class="btn btn-primary spider" id="start-spider">Start Spider</button>
          </div>
          <div><!--显示target url-->
            <table class="table table-striped">
              <tr>
                <th>编号</th>
                <th>url</th>
              </tr>
              <tr>
                <td>1</td>
                <td>http://sse.tongji.edu.cn/InfoCenter/Lastest_Notice.aspx</td>
              </tr>
            </table>
          </div>
        </div>
        <hr>
        <div>
          <div>
            <h3 class="manage-title">已抓取到的网页</h3>
            <div class="btn-group manage-btn">
              <button type="button" class="btn btn-primary" id="edit">Edit</button>
            </div>
          </div>
          <div><!--显示已抓取到的网页-->
          <table class="table table-striped" id="table-got-url">
            <tr>
              <th>编号</th>
              <th>url</th>
              <th>title</th>
              <th>date</th>
              <th>Manage</th>
            </tr>
            <!--<tr>
              <td>0</td>
              <td>http://</td>
              <td>hello</td>
              <td>wordl</td>
              <td><button class="btn btn-primary delete">Delete</button></td>
            </tr>
            <tr>
              <td>1</td>
              <td>http://</td>
              <td>hello</td>
              <td>wordl</td>
              <td><button class="btn btn-primary delete">Delete</button></td>
            </tr>-->
          </table>
          </div>
        </div>
      </div>

      <footer class="footer">
        <p>&copy; Tongji Search 2015</p>
      </footer>

    </div> <!-- /container -->
    
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="scripts/ie10-viewport-bug-workaround.js"></script>
    <script>
      //ajax管理页面
      document.getElementById('start-spider').onclick = function () {
        this.disabled = true;
        var startSpider = {'start': true};
        $.ajax({
          type: 'POST',
          url: 'http://localhost:8080/start-spider/',
          data: startSpider,
          success: function (data) {
            //向list中添加tuples
            addOriginUrl(data);
          },
          dataType: 'json'});
      };
      
      $('document').ready(function () {
        console.log("start load data");
        var loadList = {'order': 'update', 'content': ''};
        $.ajax({
          type: 'POST',
          url: 'http://localhost:8080/manage-data/',
          data: loadList,
          success: function (data) {
            addOriginUrl(data);
          },
          dataType: 'json'});
          addFunc();
      });
      
      //向origin list中添加URL
      function addOriginUrl(urlList) {
        console.log(urlList);
        for (var index = 0; index < urlList.length; index++) {
          var article = urlList[index];
          var btn = '<td><button type="button" class="btn btn-primary delete">Delete</button></td>';
          
          var temp = '<tr><td>' + index + '</td><td>' + article.url + '</td><td>' + article.title + '</td><td>' + article.date + '</td>' + btn + '</tr>';
          $('#table-got-url').append(temp);
          
        }
        $('#start-spider').disabled =false;
        addFunc();
      }
      
      function addFunc() {
        var deleteBtn = document.getElementsByClassName('delete');
        for (var index = 0; index < deleteBtn.length; index++) {
          deleteBtn[index].onclick = function () {
            var parent = (this.parentNode).parentNode;
            parent.remove();

            var deletedRecord = {'order': 'deleteGot', 'content': index};
            //删除数据库中记录
            $.ajax({
              type: 'POST',
              url: 'http://localhost:8080/manage-date/',
              date: deletedRecord,
              success: function(data) {
                //删除对应行回调函数
              },
              dataType: 'json'});
          }
        } 
      }

      //向target list中添加URL  
      // function addTargetUrl(urlList) {
        
      // }

    </script>
  </body>
</html>
